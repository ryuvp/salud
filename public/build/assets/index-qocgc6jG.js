import{b as i,F as re,z as ue,r as m,o as v,c as p,C as o,a as s,B as r,E as h,G as b,H as f,Z as ce,n as me}from"./_plugin-vue_export-helper-DRuSU7Sp.js";import{e as ve,F as pe}from"./app-SQe7OV8o.js";import{U as fe}from"./user-BG8TCbkm.js";import{R as _e}from"./roles-DGNZBkQD.js";import{I as he,U as be,R as ye}from"./ipress-B-l7SzRy.js";const ge={class:"grid"},we={class:"col-12"},Ve={class:"card"},ke={class:"my-2"},xe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Ue=o("h5",{class:"m-0"},"Manage Users",-1),Ce=o("span",{class:"p-column-title"},"Documento",-1),Re=o("span",{class:"p-column-title"},"Nombre",-1),De=o("span",{class:"p-column-title"},"Correo Electronico",-1),Se=o("span",{class:"p-column-title"},"IPRESS",-1),qe=o("span",{class:"p-column-title"},"Rol",-1),Ie={key:0},Fe={class:"formgrid grid"},Me={class:"field col"},Ne=o("label",{for:"role"},"Rol",-1),Ee={key:0,class:"p-invalid"},Le={class:"field col"},Te=o("label",{for:"document"},"Documento",-1),Pe={key:0,class:"p-invalid"},Be={class:"field"},$e=o("label",{for:"name"},"Nombres",-1),Ae={key:0,class:"p-invalid"},je={class:"field"},ze=o("label",{for:"lastname"},"Apellidos",-1),Ke={key:0,class:"p-invalid"},Oe={class:"formgrid grid"},Ge={class:"field col"},He=o("label",{for:"email"},"Email",-1),Ye={key:0,class:"p-invalid"},Ze={class:"field col"},Je=o("label",{for:"phone"},"Telefono",-1),Qe={class:"formgrid grid"},We={class:"field col"},Xe=o("label",{for:"birthdate"},"Fecha de nacimiento",-1),el={class:"field col"},ll=o("label",{for:"sex"},"Sexo",-1),al={class:"formgrid grid"},ol={class:"field col"},sl=o("label",{for:"department"},"Departamento",-1),tl={class:"field col"},il=o("label",{for:"province"},"Provincia",-1),nl={class:"field col"},dl=o("label",{for:"district"},"Distrito",-1),rl={class:"field"},ul=o("label",{for:"ipress"},"Ipress",-1),cl={class:"formgrid grid"},ml={class:"field col"},vl=o("label",{for:"password"},"Contraseña",-1),pl={key:0,class:"p-invalid"},fl={class:"field col"},_l=o("label",{for:"confirm-password"},"Repita la contraseña",-1),hl={key:0,class:"p-invalid"},bl={class:"flex align-items-center justify-content-center"},yl=o("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),gl={key:0},Rl={__name:"index",setup(wl){const y=ve(),e=i({}),M=i(null),N=i(null),E=i(null),L=i(null),T=i(null),P=i(null),c=i({}),g=i(null),k=i(null);i(null);const B=i(null),j=i(null),x=i({}),n=i(!1),z=["superadmin","paciente","administrator"],R=i(!1),D=i(!1),u=i(!1),K=i([{name:"Masculino",id:0},{name:"Femenino",id:1}]),U=new fe,O=new _e,G=new ye,S=new be,H=new he;re(()=>{oe()}),ue(()=>{q()});const Y=()=>{e.value={},n.value=!1,g.value=!0,$(),S.departments().then(t=>{E.value=t.filter(l=>l.id==10)})},q=async()=>{try{const t=await U.list();M.value=t.data.map(l=>(l.roles&&l.roles.length>0?l.role={id:l.roles[0].id,name:l.roles[0].name}:l.role={id:0,name:""},l))}catch{y.add({severity:"error",summary:"Error",detail:"Error al cargar los usuarios",life:3e3})}},$=()=>{O.get().then(t=>{N.value=t.data.filter(l=>!z.includes(l.name)).map(l=>({name:l.name,id:l.id}))})},Z=()=>{S.provinces(c.value.department.id).then(t=>{L.value=t})},J=()=>{S.districts(c.value.province.id).then(t=>{T.value=t})},Q=()=>{H.ipress(c.value.district.ubigeo_inei).then(t=>{P.value=t})},W=()=>{e.value={},c.value={},g.value=!1,n.value=!1},X=async()=>{if(n.value=!0,u){if(!e.value.name||!e.value.lastname||!e.value.document||!e.value.email||e.value.sex===null||e.value.sex===void 0||!e.value.role)return}else if(!e.value.name||!e.value.lastname||!e.value.document||!e.value.email||!e.value.password||e.value.password!==e.value.confirm_password||e.value.sex===null||e.value.sex===void 0||!e.value.role||!e.value.role.id)return;try{let t;if(u.value?t=await U.update(e.value.id,e.value):t=await U.store(e.value),t){const{status:l,message:d}=t;l==="success"?(e.value={},c.value={},g.value=!1,q(),y.add({severity:l,summary:l,detail:d,life:3e3}),n.value=!1,u.value=!1):y.add({severity:l,summary:l,detail:d,life:3e3})}}catch(t){y.add({severity:"error",summary:"Error",detail:t,life:3e3})}},ee=t=>{$(),e.value={...t},e.value.role&&e.value.role.id&&(e.value.role=e.value.role.id),g.value=!0,u.value=!0},le=t=>{e.value=t,k.value=!0},ae=()=>{U.destroy(e.value.id).then(t=>{const{status:l,message:d}=t;l==="success"?(k.value=!1,q(),y.add({severity:l,summary:l,detail:d,life:3e3})):y.add({severity:l,summary:l,detail:d,life:3e3})})},oe=()=>{x.value={global:{value:null,matchMode:pe.CONTAINS}}},se=()=>{R.value||(R.value=!0,G.get(e.value.document).then(t=>{const{nombres:l,apellido_paterno:d,apellido_materno:I}=t.data;e.value.name=l,e.value.lastname=`${d} ${I}`,D.value=!0,me(()=>{const C=document.getElementById("email");C&&C.focus()})}).catch(t=>{console.error("Error al consultar el documento:",t),R.value=!1}))};return(t,l)=>{const d=m("Button"),I=m("FileUpload"),C=m("Toolbar"),te=m("InputIcon"),_=m("InputText"),ie=m("IconField"),w=m("Column"),ne=m("DataTable"),V=m("Dropdown"),de=m("Calendar"),A=m("Dialog");return v(),p("div",ge,[o("div",we,[o("div",Ve,[s(C,{class:"mb-4"},{start:r(()=>[o("div",ke,[s(d,{label:"New",icon:"pi pi-plus",class:"mr-2",severity:"success",onClick:Y})])]),end:r(()=>[s(I,{mode:"basic",accept:"image/*",maxFileSize:1e6,label:"Import",chooseLabel:"Import",class:"mr-2 inline-block",disabled:""}),s(d,{label:"Export",icon:"pi pi-upload",severity:"help",onClick:l[0]||(l[0]=a=>t.exportCSV(a)),disabled:""})]),_:1}),s(ne,{ref_key:"dt",ref:j,value:M.value,selection:B.value,"onUpdate:selection":l[2]||(l[2]=a=>B.value=a),dataKey:"id",paginator:!0,rows:10,filters:x.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} users"},{header:r(()=>[o("div",xe,[Ue,s(ie,{iconPosition:"left",class:"block mt-2 md:mt-0"},{default:r(()=>[s(te,{class:"pi pi-search"}),s(_,{class:"w-full sm:w-auto",modelValue:x.value.global.value,"onUpdate:modelValue":l[1]||(l[1]=a=>x.value.global.value=a),placeholder:"Search..."},null,8,["modelValue"])]),_:1})])]),default:r(()=>[s(w,{field:"document",header:"Documento",sortable:!1,headerStyle:"width:14%; min-width:10rem;"},{body:r(a=>[Ce,h(" "+b(a.data.document),1)]),_:1}),s(w,{field:"name",header:"Nombre",sortable:!1,headerStyle:"width:31%; min-width:10rem;"},{body:r(a=>[Re,h(" "+b(a.data.name)+", "+b(a.data.lastname),1)]),_:1}),s(w,{field:"email",header:"Correo",sortable:!1,headerStyle:"width:14%; min-width:10rem;"},{body:r(a=>[De,h(" "+b(a.data.email),1)]),_:1}),s(w,{field:"ipress",header:"Ipress",sortable:!1,headerStyle:"width:31%; min-width:10rem;"},{body:r(a=>[Se,h(" "+b(a.data.ipress?a.data.ipress.name:""),1)]),_:1}),s(w,{field:"role",header:"Rol",sortable:!1,headerStyle:"width:10%; min-width:10rem;"},{body:r(a=>[qe,h(" "+b(a.data.roles.map(F=>F.name).join(", ")),1)]),_:1}),s(w,{headerStyle:"min-width:10rem;"},{body:r(a=>[a.data.role.id!==1&&a.data.role.id!==2?(v(),p("div",Ie,[s(d,{icon:"pi pi-pencil",class:"mr-2",severity:"success",rounded:"",onClick:F=>ee(a.data)},null,8,["onClick"]),s(d,{icon:"pi pi-trash",class:"mt-2",severity:"warning",rounded:"",onClick:F=>le(a.data)},null,8,["onClick"])])):f("",!0)]),_:1})]),_:1},8,["value","selection","filters"]),s(A,{visible:g.value,"onUpdate:visible":l[17]||(l[17]=a=>g.value=a),style:{width:"720px"},header:"Detalles del usuario",modal:!0,class:"p-fluid"},{footer:r(()=>[s(d,{label:"Cancel",icon:"pi pi-times",text:"",onClick:W}),s(d,{label:"Save",icon:"pi pi-check",text:"",onClick:X})]),default:r(()=>[o("div",Fe,[o("div",Me,[Ne,s(V,{id:"role",modelValue:e.value.role,"onUpdate:modelValue":l[3]||(l[3]=a=>e.value.role=a),options:N.value,optionLabel:"name",optionValue:"id",required:"true",invalid:n.value&&!e.value.role,placeholder:"Select a Role"},null,8,["modelValue","options","invalid"]),n.value&&!e.value.role?(v(),p("small",Ee,"Rol es requerido.")):f("",!0)]),o("div",Le,[Te,s(_,{id:"document",modelValue:e.value.document,"onUpdate:modelValue":l[4]||(l[4]=a=>e.value.document=a),modelModifiers:{trim:!0},required:"true",autofocus:"",disabled:u.value,invalid:n.value&&!e.value.document,onKeyup:ce(se,["enter"])},null,8,["modelValue","disabled","invalid"]),n.value&&!e.value.document?(v(),p("small",Pe,"Documento es requerido.")):f("",!0)])]),o("div",Be,[$e,s(_,{id:"name",modelValue:e.value.name,"onUpdate:modelValue":l[5]||(l[5]=a=>e.value.name=a),modelModifiers:{trim:!0},disabled:D.value||u.value,required:"true",autofocus:"",invalid:n.value&&!e.value.name},null,8,["modelValue","disabled","invalid"]),n.value&&!e.value.name?(v(),p("small",Ae,"Nombre es requerido.")):f("",!0)]),o("div",je,[ze,s(_,{id:"lastname",modelValue:e.value.lastname,"onUpdate:modelValue":l[6]||(l[6]=a=>e.value.lastname=a),modelModifiers:{trim:!0},disabled:D.value||u.value,required:"true",invalid:n.value&&!e.value.lastname},null,8,["modelValue","disabled","invalid"]),n.value&&!e.value.lastname?(v(),p("small",Ke,"Apellidos es requerido.")):f("",!0)]),o("div",Oe,[o("div",Ge,[He,s(_,{id:"email",modelValue:e.value.email,"onUpdate:modelValue":l[7]||(l[7]=a=>e.value.email=a),modelModifiers:{trim:!0},required:"true",invalid:n.value&&!e.value.email,ref:"emailField"},null,8,["modelValue","invalid"]),n.value&&!e.value.email?(v(),p("small",Ye,"Email es requerido.")):f("",!0)]),o("div",Ze,[Je,s(_,{id:"phone",modelValue:e.value.phone,"onUpdate:modelValue":l[8]||(l[8]=a=>e.value.phone=a),modelModifiers:{trim:!0},required:"false"},null,8,["modelValue"])])]),o("div",Qe,[o("div",We,[Xe,s(de,{id:"birthdate",modelValue:e.value.birthdate,"onUpdate:modelValue":l[9]||(l[9]=a=>e.value.birthdate=a),dateFormat:"dd/mm/yy",required:"false",autofocus:""},null,8,["modelValue"])]),o("div",el,[ll,s(V,{id:"sex",modelValue:e.value.sex,"onUpdate:modelValue":l[10]||(l[10]=a=>e.value.sex=a),options:K.value,optionLabel:"name",optionValue:"id",required:"false",placeholder:"Select a Sex"},null,8,["modelValue","options"])])]),o("div",al,[o("div",ol,[sl,s(V,{id:"department",modelValue:c.value.department,"onUpdate:modelValue":l[11]||(l[11]=a=>c.value.department=a),onChange:Z,options:E.value,optionLabel:"name",placeholder:"Select a Department"},null,8,["modelValue","options"])]),o("div",tl,[il,s(V,{id:"province",modelValue:c.value.province,"onUpdate:modelValue":l[12]||(l[12]=a=>c.value.province=a),onChange:J,options:L.value,optionLabel:"name",placeholder:"Select a Province"},null,8,["modelValue","options"])]),o("div",nl,[dl,s(V,{id:"district",modelValue:c.value.district,"onUpdate:modelValue":l[13]||(l[13]=a=>c.value.district=a),onChange:Q,options:T.value,optionLabel:"name",placeholder:"Select a District"},null,8,["modelValue","options"])])]),o("div",rl,[ul,s(V,{id:"ipress",modelValue:e.value.ipress,"onUpdate:modelValue":l[14]||(l[14]=a=>e.value.ipress=a),options:P.value,required:"true",optionLabel:"name",placeholder:"Select an Ipress"},null,8,["modelValue","options"])]),o("div",cl,[o("div",ml,[vl,s(_,{id:"password",modelValue:e.value.password,"onUpdate:modelValue":l[15]||(l[15]=a=>e.value.password=a),modelModifiers:{trim:!0},required:u.value,autofocus:"",invalid:n.value&&!e.value.password&&!u.value},null,8,["modelValue","required","invalid"]),n.value&&!e.value.password&&!u.value?(v(),p("small",pl,"Contraseña es requerida.")):f("",!0)]),o("div",fl,[_l,s(_,{id:"confirm-password",modelValue:e.value.confirm_password,"onUpdate:modelValue":l[16]||(l[16]=a=>e.value.confirm_password=a),modelModifiers:{trim:!0},required:u.value,autofocus:"",invalid:n.value&&!e.value.confirm_password&&!u.value},null,8,["modelValue","required","invalid"]),n.value&&!e.value.confirm_password&&!u.value?(v(),p("small",hl,"Repita la contraseña.")):f("",!0)])])]),_:1},8,["visible"]),s(A,{visible:k.value,"onUpdate:visible":l[19]||(l[19]=a=>k.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[s(d,{label:"No",icon:"pi pi-times",text:"",onClick:l[18]||(l[18]=a=>k.value=!1)}),s(d,{label:"Yes",icon:"pi pi-check",text:"",onClick:ae})]),default:r(()=>[o("div",bl,[yl,e.value?(v(),p("span",gl,[h("Are you sure you want to delete "),o("b",null,b(e.value.name),1),h("?")])):f("",!0)])]),_:1},8,["visible"])])])])}}};export{Rl as default};
