import{b as i,p as fe,F as _e,z as he,r as c,o as m,c as p,C as o,a as t,B as r,I as be,H as f,E as g,G as V,Z as ye,n as ge}from"./_plugin-vue_export-helper-DRuSU7Sp.js";import{e as Ve,b as we,F as xe}from"./app-SQe7OV8o.js";import{U as ke}from"./user-BG8TCbkm.js";import{I as Ue,U as De,R as Ce}from"./ipress-B-l7SzRy.js";import{A as Se}from"./AppLoadingScreen-lBsNdxeX.js";const Ie={class:"grid"},Pe={class:"col-12"},Fe={class:"card"},qe={class:"my-2"},Le={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},Re=o("h5",{class:"m-0"},"Administrar Pacientes",-1),Me=o("span",{class:"p-column-title"},"Documento",-1),Ne=o("span",{class:"p-column-title"},"Apellidos y Nombres",-1),Te=o("span",{class:"p-column-title"},"Edad",-1),Ee=o("span",{class:"p-column-title"},"Sexo",-1),Ae=o("span",{class:"p-column-title"},"IPRESS",-1),Be={key:0},$e={class:"formgrid grid"},ze={class:"field col"},Ke=o("label",{for:"department"},"Departamento",-1),je={class:"field col"},He=o("label",{for:"province"},"Provincia",-1),Oe={class:"field col"},Ge=o("label",{for:"district"},"Distrito",-1),We={class:"field"},Ye=o("label",{for:"ipress"},"Ipress",-1),Ze={class:"formgrid grid"},Je={class:"field col"},Qe=o("label",{for:"document"},"Documento",-1),Xe={key:0,class:"p-invalid"},el={class:"field col"},ll=o("label",{for:"name"},"Nombres",-1),al={key:0,class:"p-invalid"},ol={class:"field"},sl=o("label",{for:"lastname"},"Apellidos",-1),tl={key:0,class:"p-invalid"},il={class:"formgrid grid"},nl={class:"field col"},dl=o("label",{for:"email"},"Email",-1),rl={class:"field col"},ul=o("label",{for:"phone"},"Telefono",-1),cl={class:"field col"},ml=o("label",{for:"clinic_history"},"Historia Clinica",-1),vl={class:"formgrid grid"},pl={class:"field col"},fl=o("label",{for:"birthdate"},"Fecha de nacimiento",-1),_l={key:0,class:"p-invalid"},hl={class:"field col"},bl=o("label",{for:"sex"},"Sexo",-1),yl={key:0,class:"p-invalid"},gl={class:"formgrid grid"},Vl={class:"field col"},wl=o("label",{for:"department"},"Departamento",-1),xl={class:"field col"},kl=o("label",{for:"province"},"Provincia",-1),Ul={class:"field col"},Dl=o("label",{for:"district"},"Distrito",-1),Cl={class:"field"},Sl=o("label",{for:"address"},"Dirección",-1),Il={key:0,class:"p-invalid"},Pl={class:"flex align-items-center justify-content-center"},Fl=o("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ql={key:0},Al={__name:"index",setup(Ll){const y=Ve(),l=i({}),R=i(null),P=i(null),M=i(null),N=i(null),T=i(null),E=i(null),A=i(null),u=i({}),v=i({}),w=i(null),k=i(null),z=i(null),C=i({}),n=i(!1),S=i(!1),U=i(!1),_=i(!1),K=i([{name:"Masculino",id:0},{name:"Femenino",id:1}]),F=i(!1),j=we(),H=fe(()=>j.roles),I=new ke,O=new Ce,D=new De,G=new Ue;_e(()=>{ie()}),he(()=>{q()});const W=()=>{l.value={},n.value=!1,w.value=!0,Y()},q=async()=>{try{const s=await I.patients();R.value=s.data}catch{y.add({severity:"error",summary:"Error",detail:"Error al cargar los usuarios",life:3e3})}},Y=()=>{D.departments().then(s=>{P.value=s.filter(e=>e.id==10)})},Z=()=>{D.provinces(v.value.department.id).then(s=>{M.value=s})},J=()=>{D.provinces(u.value.department.id).then(s=>{T.value=s})},Q=()=>{D.districts(v.value.province.id).then(s=>{N.value=s})},X=()=>{D.districts(u.value.province.id).then(s=>{E.value=s})},ee=()=>{G.ipress(v.value.district.ubigeo_inei).then(s=>{A.value=s})},le=()=>{l.value={},u.value={},w.value=!1,n.value=!1,U.value=!1,_.value=!1,S.value=!1},ae=async()=>{if(n.value=!0,_){if(!l.value.name||!l.value.lastname||!l.value.document||l.value.sex===null||l.value.sex===void 0)return}else if(!l.value.name||!l.value.lastname||!l.value.document||!l.value.password||l.value.password!==l.value.confirm_password||l.value.sex===null||l.value.sex===void 0)return;try{l.value.ubigeo=u.value.district.ubigeo_inei;let s;if(_.value?s=await I.update(l.value.id,l.value):s=await I.storePatient(l.value),s){const{status:e,message:d}=s;e==="success"?(l.value={},u.value={},w.value=!1,q(),y.add({severity:e,summary:e,detail:d,life:3e3}),n.value=!1,_.value=!1):y.add({severity:e,summary:e,detail:d,life:3e3})}}catch(s){y.add({severity:"error",summary:"Error",detail:s,life:3e3})}},oe=s=>{l.value={...s},w.value=!0,_.value=!0},se=s=>{l.value=s,k.value=!0},te=()=>{I.destroy(l.value.id).then(s=>{const{status:e,message:d}=s;e==="success"?(k.value=!1,q(),y.add({severity:e,summary:e,detail:d,life:3e3})):y.add({severity:e,summary:e,detail:d,life:3e3})})},ie=()=>{C.value={global:{value:null,matchMode:xe.CONTAINS}}},ne=async()=>{if(!S.value){S.value=!0,F.value=!0;try{const s=await O.get(l.value.document);if(s.success){const{nombres:e,apellido_paterno:d,apellido_materno:L}=s.data;l.value.name=e,l.value.lastname=`${d} ${L}`,U.value=!0,B("email")}else de(s.message),S.value=!1,U.value=!1,B("name")}catch{}finally{F.value=!1}}},B=s=>{ge(()=>{const e=document.getElementById(s);e&&e.focus()})},de=s=>{y.add({severity:"warn",summary:"Alerta",detail:`${s} Ingrese los datos manualmente`,life:3e3})};return(s,e)=>{const d=c("Button"),L=c("FileUpload"),re=c("Toolbar"),ue=c("InputIcon"),h=c("InputText"),ce=c("IconField"),x=c("Column"),me=c("DataTable"),b=c("Dropdown"),ve=c("Calendar"),$=c("Dialog");return m(),p("div",Ie,[o("div",Pe,[o("div",Fe,[t(re,{class:"mb-4"},{start:r(()=>[o("div",qe,[t(d,{label:"New",icon:"pi pi-plus",class:"mr-2",severity:"success",onClick:W})])]),end:r(()=>[t(L,{mode:"basic",accept:"image/*",maxFileSize:1e6,label:"Import",chooseLabel:"Import",class:"mr-2 inline-block",disabled:""}),t(d,{label:"Export",icon:"pi pi-upload",severity:"help",onClick:e[0]||(e[0]=a=>s.exportCSV(a)),disabled:""})]),_:1}),t(me,{ref_key:"dt",ref:z,value:R.value,dataKey:"id",paginator:!0,rows:10,filters:C.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} users"},{header:r(()=>[o("div",Le,[Re,t(ce,{iconPosition:"left",class:"block mt-2 md:mt-0"},{default:r(()=>[t(ue,{class:"pi pi-search"}),t(h,{class:"w-full sm:w-auto",modelValue:C.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=a=>C.value.global.value=a),placeholder:"Search..."},null,8,["modelValue"])]),_:1})])]),default:r(()=>[t(x,{field:"document",header:"Documento",sortable:!1,headerStyle:"width:14%; min-width:10rem;"},{body:r(a=>[Me,g(" "+V(a.data.document),1)]),_:1}),t(x,{field:"name",header:"Nombre",sortable:!1,headerStyle:"width:31%; min-width:10rem;"},{body:r(a=>[Ne,g(" "+V(a.data.lastname)+", "+V(a.data.name),1)]),_:1}),t(x,{field:"age",header:"Edad",sortable:!1,headerStyle:"width:14%; min-width:10rem;"},{body:r(a=>[Te,g(" "+V(a.data.age),1)]),_:1}),t(x,{field:"sex",header:"Sexo",sortable:!1,headerStyle:"width:10%; min-width:10rem;"},{body:r(a=>[Ee,g(" "+V(a.data.sex_format),1)]),_:1}),t(x,{field:"ipress",header:"Ipress",sortable:!1,headerStyle:"width:31%; min-width:10rem;"},{body:r(a=>[Ae,g(" "+V(a.data.ipress?a.data.ipress.name:""),1)]),_:1}),t(x,{headerStyle:"min-width:10rem;"},{body:r(a=>[t(d,{icon:"pi pi-pencil",class:"mr-2",severity:"success",rounded:"",onClick:pe=>oe(a.data)},null,8,["onClick"]),t(d,{icon:"pi pi-trash",class:"mt-2",severity:"warning",rounded:"",onClick:pe=>se(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","filters"]),t($,{visible:w.value,"onUpdate:visible":e[18]||(e[18]=a=>w.value=a),style:{width:"720px"},header:"Detalles del usuario",modal:!0,class:"p-fluid"},{footer:r(()=>[t(d,{label:"Cancel",icon:"pi pi-times",text:"",onClick:le}),t(d,{label:"Save",icon:"pi pi-check",text:"",onClick:ae})]),default:r(()=>[H.value.some(a=>a.name==="superadmin"||a.name==="administrator")?(m(),p("div",Be,[o("div",$e,[o("div",ze,[Ke,t(b,{id:"department",modelValue:v.value.department,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value.department=a),onChange:Z,options:P.value,optionLabel:"name",placeholder:"Select a Department"},null,8,["modelValue","options"])]),o("div",je,[He,t(b,{id:"province",modelValue:v.value.province,"onUpdate:modelValue":e[3]||(e[3]=a=>v.value.province=a),onChange:Q,options:M.value,optionLabel:"name",placeholder:"Select a Province"},null,8,["modelValue","options"])]),o("div",Oe,[Ge,t(b,{id:"district",modelValue:v.value.district,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.district=a),onChange:ee,options:N.value,optionLabel:"name",placeholder:"Select a District"},null,8,["modelValue","options"])])]),o("div",We,[Ye,t(b,{id:"ipress",modelValue:l.value.ipress,"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.ipress=a),options:A.value,required:"true",optionLabel:"name",placeholder:"Select an Ipress"},null,8,["modelValue","options"])])])):f("",!0),o("div",Ze,[o("div",Je,[Qe,t(h,{id:"document",modelValue:l.value.document,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.document=a),modelModifiers:{trim:!0},required:"true",autofocus:"",disabled:_.value,invalid:n.value&&!l.value.document,onKeyup:ye(ne,["enter"])},null,8,["modelValue","disabled","invalid"]),n.value&&!l.value.document?(m(),p("small",Xe,"Documento es requerido.")):f("",!0)]),o("div",el,[ll,t(h,{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.name=a),modelModifiers:{trim:!0},disabled:U.value||_.value,required:"true",autofocus:"",invalid:n.value&&!l.value.name,ref:"nameField"},null,8,["modelValue","disabled","invalid"]),n.value&&!l.value.name?(m(),p("small",al,"Nombre es requerido.")):f("",!0)])]),o("div",ol,[sl,t(h,{id:"lastname",modelValue:l.value.lastname,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.lastname=a),modelModifiers:{trim:!0},disabled:U.value||_.value,required:"true",invalid:n.value&&!l.value.lastname},null,8,["modelValue","disabled","invalid"]),n.value&&!l.value.lastname?(m(),p("small",tl,"Apellidos es requerido.")):f("",!0)]),o("div",il,[o("div",nl,[dl,t(h,{id:"email",modelValue:l.value.email,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.email=a),modelModifiers:{trim:!0},required:"false",ref:"emailField"},null,8,["modelValue"])]),o("div",rl,[ul,t(h,{id:"phone",modelValue:l.value.phone,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.phone=a),modelModifiers:{trim:!0},required:"false"},null,8,["modelValue"])]),o("div",cl,[ml,t(h,{id:"clinic_history",modelValue:l.value.clinic_history,"onUpdate:modelValue":e[11]||(e[11]=a=>l.value.clinic_history=a),modelModifiers:{trim:!0},required:"false"},null,8,["modelValue"])])]),o("div",vl,[o("div",pl,[fl,t(ve,{id:"birthdate",modelValue:l.value.birthdate,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.birthdate=a),dateFormat:"dd/mm/yy",required:"true",placeholder:"Día/Mes/Año",autofocus:"",invalid:n.value&&!l.value.birthdate},null,8,["modelValue","invalid"]),n.value&&!l.value.birthdate?(m(),p("small",_l,"Fecha de nacimiento es requerido.")):f("",!0)]),o("div",hl,[bl,t(b,{id:"sex",modelValue:l.value.sex,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.sex=a),options:K.value,optionLabel:"name",optionValue:"id",required:"true",placeholder:"Select a Sex",invalid:n.value&&!l.value.sex},null,8,["modelValue","options","invalid"]),n.value&&!l.value.sex?(m(),p("small",yl,"Sexo es requerido.")):f("",!0)])]),o("div",gl,[o("div",Vl,[wl,t(b,{id:"department",modelValue:u.value.department,"onUpdate:modelValue":e[14]||(e[14]=a=>u.value.department=a),onChange:J,options:P.value,optionLabel:"name",placeholder:"Select a Department"},null,8,["modelValue","options"])]),o("div",xl,[kl,t(b,{id:"province",modelValue:u.value.province,"onUpdate:modelValue":e[15]||(e[15]=a=>u.value.province=a),onChange:X,options:T.value,optionLabel:"name",placeholder:"Select a Province"},null,8,["modelValue","options"])]),o("div",Ul,[Dl,t(b,{id:"district",modelValue:u.value.district,"onUpdate:modelValue":e[16]||(e[16]=a=>u.value.district=a),options:E.value,optionLabel:"name",placeholder:"Select a District"},null,8,["modelValue","options"])])]),o("div",Cl,[Sl,t(h,{id:"address",modelValue:l.value.address,"onUpdate:modelValue":e[17]||(e[17]=a=>l.value.address=a),modelModifiers:{trim:!0},required:"true",invalid:n.value&&!l.value.address},null,8,["modelValue","invalid"]),n.value&&!l.value.address?(m(),p("small",Il,"Dirección es requerido.")):f("",!0)])]),_:1},8,["visible"]),t($,{visible:k.value,"onUpdate:visible":e[20]||(e[20]=a=>k.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[t(d,{label:"No",icon:"pi pi-times",text:"",onClick:e[19]||(e[19]=a=>k.value=!1)}),t(d,{label:"Yes",icon:"pi pi-check",text:"",onClick:te})]),default:r(()=>[o("div",Pl,[Fl,l.value?(m(),p("span",ql,[g("Are you sure you want to delete "),o("b",null,V(l.value.name),1),g("?")])):f("",!0)])]),_:1},8,["visible"])])]),F.value?(m(),be(Se,{key:0})):f("",!0)])}}};export{Al as default};
